{% extends 'base.html' %}

{% block title %}
  {{block.super}} Welcome back, {{ student.name }}
{% endblock %}

{% block content %}
    <div class="well">
    	<h3>Welcome back, {{ student.name }}!</h3>
    	{% if student.current_payments %}
    		<h4>Your current plans are:</h4>
    		{% for payment in student.current_payments %}
    			<p>{{payment.plan.name}}: Expires {{payment.plan.end_date}}. <br></p>
    		{% endfor %}
    	{% else %}
    		<h4>You currently don't have any plans.</h4>
            <a href="/selectpayment/" class="btn btn-primary">Sign up for a plan &raquo;</a>
    	{% endif %}
        {% if student.waiver_signed %}
            <p>Waiver signed: <i class="icon-ok-circle icon-large"></i></p>
    	{% else %}
    		<h3>You must sign the following waiver before you are eligible to ride.</h3>
    		<div class='waiver-wrapper'>
    	       {% include "waiver.html" %}
    		</div>
            <br>
    		<button id="accept" class="btn btn-primary">I Accept this Waiver &#187;</button>
            <span id="waiver-result"></span>
            <br>
            <label>Clicking this button counts as your digital signature and is legally binding</label>
    	{% endif %}
        {% if student.can_ride %}
            <h4>You are currently eligible to ride! Visit our <a href="/locations/">locations</a> page to find the nearest bikes.</h4>
        {% endif %}
    </div>
{% endblock %}

{% block scripts %}
<script src="{{ STATIC_URL }}js/django_ajax.js" type="text/javascript"></script>
<script>
    $("#accept").click(function() {
        $.ajax({
            type: "POST",
            url: "/verify_waiver",
            data: {
                pennid: "{{ student.penncard }}",
            },
            dataType: 'json',
            error: function(xhr, status, exception) {
                $("#waiver-result").html("There was a problem with our server. Try refreshing the page.");
            },
            success: function(xhr, status, exception) {
                $("#waiver-result").html("Successfully submitted waiver.");
            }
        });
    });
</script>
{% endblock %}